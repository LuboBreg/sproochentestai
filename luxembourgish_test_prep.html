<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxembourgish Test Preparation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }

        .nav-tab {
            flex: 1;
            min-width: 150px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .nav-tab.active {
            background: white;
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: bold;
        }

        .nav-tab:hover:not(.active) {
            background: #e9ecef;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-icon {
            font-size: 2rem;
            margin-right: 15px;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }

        .card-subtitle {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* Voice Recording Styles */
        .recording-section {
            background: #f0f8ff;
            border: 2px solid #4a90e2;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .recording-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .record-btn, .play-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .record-btn {
            background: #ff4757;
            color: white;
        }

        .record-btn:hover {
            background: #ff3742;
        }

        .record-btn.recording {
            background: #ff6b7a;
            animation: pulse 1.5s infinite;
        }

        .play-btn {
            background: #2ed573;
            color: white;
        }

        .play-btn:hover {
            background: #26d667;
        }

        .play-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .recording-status {
            font-weight: bold;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .recording-status.recording {
            background: #ffe5e5;
            color: #ff4757;
        }

        .recording-status.ready {
            background: #e5f7e5;
            color: #2ed573;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* Sample sections */
        .sample-answer {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .questions-list {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .questions-list ul {
            margin-left: 20px;
        }

        .questions-list li {
            margin-bottom: 8px;
        }

        /* Phrases Section */
        .phrase-section {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 4px solid #6c757d;
        }

        .phrase-section h4 {
            color: #495057;
            margin-bottom: 15px;
        }

        .phrase-section ul {
            margin-left: 20px;
        }

        .phrase-section li {
            margin-bottom: 8px;
        }

        /* Modal for conversation details */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-header h2 {
            margin: 0;
            padding-right: 40px;
        }

        .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: white;
        }

        .modal-body {
            padding: 30px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                min-width: auto;
            }
            
            .modal-content {
                width: 95%;
                margin: 5% auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üá±üá∫ L√´tzebuergesch Test Prep</h1>
            <p>Complete preparation with authentic materials and voice recording practice</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">üìã Overview</button>
            <button class="nav-tab" onclick="showTab('pictures')">üì∏ Pictures</button>
            <button class="nav-tab" onclick="showTab('conversation')">üí¨ Conversation</button>
            <button class="nav-tab" onclick="showTab('phrases')">üìù Phrases</button>
        </div>

        <div class="content">
            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <div class="info-box">
                    <h3>üéØ Your Test Has Two Parts:</h3>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>Picture Description (2-3 minutes):</strong> Describe what you see in a photo using Luxembourgish</li>
                        <li><strong>Conversation (5 minutes):</strong> Answer questions about daily life topics</li>
                    </ul>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-top: 30px;">
                    <div class="card" onclick="showTab('pictures')">
                        <div class="card-header">
                            <div class="card-icon">üì∏</div>
                            <div>
                                <div class="card-title">Picture Descriptions</div>
                                <div class="card-subtitle">Practice with authentic examples</div>
                            </div>
                        </div>
                        <div>Complete model descriptions in Luxembourgish from your study materials</div>
                    </div>

                    <div class="card" onclick="showTab('conversation')">
                        <div class="card-header">
                            <div class="card-icon">üí¨</div>
                            <div>
                                <div class="card-title">Conversation Practice</div>
                                <div class="card-subtitle">With voice recording</div>
                            </div>
                        </div>
                        <div>Practice answering questions and record yourself speaking Luxembourgish</div>
                    </div>
                </div>

                <div style="margin-top: 30px; background: #e3f2fd; padding: 20px; border-radius: 10px;">
                    <h3 style="color: #1976d2; margin-bottom: 15px;">üí° Test Tips:</h3>
                    <ul style="margin-left: 20px;">
                        <li>Start picture descriptions with: <strong>"Am Bild gesinn ech..."</strong></li>
                        <li>Always mention if the photo was taken inside or outside</li>
                        <li>Describe foreground and background</li>
                        <li>Comment on the weather and season</li>
                        <li>For conversations, give complete answers with examples</li>
                        <li>Use the voice recorder to practice pronunciation</li>
                    </ul>
                </div>
            </div>

            <!-- Pictures Tab -->
            <div id="pictures" class="tab-content">
                <div class="info-box">
                    <h3>üì∏ Picture Description Practice</h3>
                    <p>Click on any picture to see the complete model description in Luxembourgish.</p>
                </div>

                <div class="cards-grid" id="pictureGrid">
                    <!-- Pictures will be loaded here -->
                </div>
            </div>

            <!-- Conversation Tab -->
            <div id="conversation" class="tab-content">
                <div class="info-box">
                    <h3>üí¨ Conversation Practice with Voice Recording</h3>
                    <p>Click on any topic to practice. You can record yourself answering the questions!</p>
                </div>

                <div class="cards-grid">
                    <div class="card" onclick="openConversationModal('beruff')">
                        <div class="card-header">
                            <div class="card-icon">üíº</div>
                            <div>
                                <div class="card-title">BERUFF</div>
                                <div class="card-subtitle">Work & Career</div>
                            </div>
                        </div>
                        <p>Practice talking about your job and career</p>
                    </div>

                    <div class="card" onclick="openConversationModal('famill')">
                        <div class="card-header">
                            <div class="card-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                            <div>
                                <div class="card-title">FAMILL</div>
                                <div class="card-subtitle">Family</div>
                            </div>
                        </div>
                        <p>Practice talking about your family</p>
                    </div>

                    <div class="card" onclick="openConversationModal('transport')">
                        <div class="card-header">
                            <div class="card-icon">üöå</div>
                            <div>
                                <div class="card-title">TRANSPORT</div>
                                <div class="card-subtitle">Transportation</div>
                            </div>
                        </div>
                        <p>Practice talking about transportation</p>
                    </div>

                    <div class="card" onclick="openConversationModal('vakanz')">
                        <div class="card-header">
                            <div class="card-icon">‚úàÔ∏è</div>
                            <div>
                                <div class="card-title">VAKANZ</div>
                                <div class="card-subtitle">Vacation</div>
                            </div>
                        </div>
                        <p>Practice talking about vacations and travel</p>
                    </div>

                    <div class="card" onclick="openConversationModal('iessen')">
                        <div class="card-header">
                            <div class="card-icon">üçΩÔ∏è</div>
                            <div>
                                <div class="card-title">IESSEN</div>
                                <div class="card-subtitle">Food</div>
                            </div>
                        </div>
                        <p>Practice talking about food and eating habits</p>
                    </div>

                    <div class="card" onclick="openConversationModal('sport')">
                        <div class="card-header">
                            <div class="card-icon">‚öΩ</div>
                            <div>
                                <div class="card-title">SPORT</div>
                                <div class="card-subtitle">Sports</div>
                            </div>
                        </div>
                        <p>Practice talking about sports and hobbies</p>
                    </div>
                </div>
            </div>

            <!-- Phrases Tab -->
            <div id="phrases" class="tab-content">
                <div class="info-box">
                    <h3>üìù Essential Phrases for Your Test</h3>
                    <p>Key phrases and sentence starters for both picture descriptions and conversations.</p>
                </div>

                <div class="phrase-section">
                    <h4>üñºÔ∏è Picture Description Starters</h4>
                    <ul>
                        <li><strong>Am Bild gesinn ech...</strong> - In the picture I see...</li>
                        <li><strong>D'Foto gouf bausse/banne geholl</strong> - The photo was taken outside/inside</li>
                        <li><strong>Am Virdergrond gesinn ech...</strong> - In the foreground I see...</li>
                        <li><strong>Am Hannergrond gesinn ech...</strong> - In the background I see...</li>
                        <li><strong>Op der l√©nkser/rietser S√§it</strong> - On the left/right side</li>
                        <li><strong>Vill√§icht ass et...</strong> - Perhaps it is...</li>
                        <li><strong>Ech mengen...</strong> - I think...</li>
                    </ul>
                </div>

                <div class="phrase-section">
                    <h4>üë• Describing People</h4>
                    <ul>
                        <li><strong>Hien/Si ass jonk/al</strong> - He/She is young/old</li>
                        <li><strong>Hien/Si huet... Joer</strong> - He/She is... years old</li>
                        <li><strong>Hien/Si huet... un</strong> - He/She is wearing...</li>
                        <li><strong>D'Leit spadz√©ieren/s√´tzen</strong> - The people are walking/sitting</li>
                        <li><strong>Hien/Si huet... Hoer</strong> - He/She has... hair</li>
                        <li><strong>D'Fra/De Mann...</strong> - The woman/man...</li>
                    </ul>
                </div>

                <div class="phrase-section">
                    <h4>üå§Ô∏è Weather & Time</h4>
                    <ul>
                        <li><strong>D'Wieder ass sch√©in/bedeckt</strong> - The weather is nice/cloudy</li>
                        <li><strong>Et ass Summer/Wanter</strong> - It's summer/winter</li>
                        <li><strong>Et ass sonneg/wollekeg</strong> - It's sunny/cloudy</li>
                        <li><strong>D'Sonn sch√©ngt</strong> - The sun is shining</li>
                        <li><strong>Et ass Owend</strong> - It's evening</li>
                        <li><strong>Et ass donkel/hell</strong> - It's dark/bright</li>
                    </ul>
                </div>

                <div class="phrase-section">
                    <h4>üí¨ Conversation Starters</h4>
                    <ul>
                        <li><strong>Ech...</strong> - I...</li>
                        <li><strong>Normalerweis...</strong> - Usually...</li>
                        <li><strong>Meeschtens...</strong> - Most of the time...</li>
                        <li><strong>Heiansdo...</strong> - Sometimes...</li>
                        <li><strong>Ech fannen...</strong> - I find/think...</li>
                        <li><strong>Mir gef√§lt...</strong> - I like...</li>
                        <li><strong>Et ass wichteg...</strong> - It's important...</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for conversation practice -->
    <div id="conversationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle"></h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Picture data
        const pictures = [
            {
                title: "Stau op Autobunn",
                subtitle: "Traffic jam on highway", 
                description: "Am Bild gesinn ech eng Stau mat villen Autoen op enger Autobunn. Vill√§icht, ass et de Beruffstrafic. D'Foto gouf bause geholl. D'Autobunn huet dr√§i Bunnen. Ganz riets steet e w√§iss Camion. D'Autoen hunn hir Scheinwerfer (headlights) un. Am Hannergrond gesinn ech blo Sch√´lter (road signs): zwee an der M√´tt, eent op riets. Am Virdergrond an der M√´tt gesinn ech eng nei greng Auto. Ech mengen, et ass Peugeot. D'Wieder ass gro an den Himmel ass bedeckt. Vill√§icht, ass et Wanter oder Hierscht."
            },
            {
                title: "Grouss Famill",
                subtitle: "Large family dining",
                description: "Am Bild gesinn ech eng ganz grouss Famill. D'Foto gouf banne geholl. D'Famill √´sst zu M√´tteg. Do ass vill Uebst um D√´sch. Op dem Bild sinn zwee Kanner. De Mann l√©nks huet e roude Pullover un. Ech mengen, de Mann l√©nks ass de Bopi well hien al ass. An der M√´tt gesinn ech eng jonk Fra. Si huet kuerz blond Hoer. D'Fra ass ongef√©ier 40 Joer al. D'Fra huet eng schwaarz Jackett un. De Jong riets √´sst eng M√´tsch. D'Meedchen op riets huet laang, blond Hoer. Hatt ass ganz jonk. De Mann op der rietser S√§it huet e w√§iss Hiem un. Hien dr√©nkt en Orang√´jus. Am Hannergrond gesinn ech eng ganz sch√©in Terasse. Ech mengen, et ass Summer, well d'Beem ganz gr√©ng sinn."
            },
            {
                title: "Famill an der Kichen",
                subtitle: "Happy family in kitchen", 
                description: "Am Bild gesinn ech eng Famill an der Kichen. D'Foto gouf banne geholl. Ech gesinn zwee Kanner, ee Meedchen an ee Jong an hir Elteren. De Jong huet ongef√©ier f√´nnef Joer. Hien huet en hellbloen T-Shirt un. Ech mengen, hien ass hongreg. Hien √´sst vill√§icht e Jugurt oder M√ºsli. Niewent dem Jong s√´tzt e Meedchen. Op dem D√´sch ass eng Planz an e Brout. De Mann huet e kar√©iert Hiem un. D'Fra huet e w√§issen T-Shirt un. Jidderee laacht / huet e Laachen am Gesiicht. D'Kichen ass sch√©in an hell. An der M√´tt ass en grouss D√´sch aus Holz."
            },
            {
                title: "Schueberfouer",
                subtitle: "Luxembourg fair with Jean de Gaufre",
                description: "Am Bild gesinn ech vill Leit op engem Fouer. Vill√§icht, ass et e Schueberfouer - d√©i gr√©isst Kiermes zu L√´tzebuerg. D'Foto gouf bausse geholl. Am Virdergrond gesinn ech verschidden Attraktiounen, Gefr√©issst√§nn an vill Leit d√©i spadz√©ieren. Am Virdergrond op der l√©nkser S√§it gesinn ech e Gefr√©issst√§nd. Et h√©icht 'Jean de Gaufre'. D'Leit k√´nnen do Eisenkuchen kafen. Ech gesinn 2 Verkeeferinen. Si sinn ganz jonk an schlank. Si hunn w√§iss Kap un. An der M√´tt gesinn ech eng Koppel - eng Mann an e Fra. Mann ass jonk an schlank. Hien huet ongef√©ier 40 Joer. Hien huet gro Levis T-Shirt an donkelgro Box un. D'Fra ass och jonk an schlank. Si huet ongef√©ier 40 Joer. Si huet w√§iss Blus un. D'Wieder ass ganz sch√©in a sonneg. Ech mengen, et ass Summer."
            }
        ];

        // Conversation topics data
        const conversationData = {
            beruff: {
                title: "üíº BERUFF - Work & Career",
                sample: "Ech si Informatikerin vu Beruff. Ech schaffen bei enger internationaler Firma zu L√´tzebuerg schonn zanter 2 Joer. Fr√©ier, hunn ech an der Ukrain geschafft.",
                questions: [
                    "Wat schafft Dir? Wat sidd dir vu Beruff?",
                    "Wou schafft dir? Sidd dir selbst√§nneg?",
                    "W√©i laang schafft Dir schonn do?",
                    "W√©ini schafft Dir? W√©i laang?",
                    "W√©i kommt dir op d'Aarbecht?",
                    "Wat maacht Dir de ganzen Dag?",
                    "Hutt Dir √Ñr Aarbecht g√§r?"
                ]
            },
            famill: {
                title: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶ FAMILL - Family",
                sample: "Meng Famill ass net grouss. Ech si bestuet zanter 14 Joer. Mir hunn zwee Kanner, zwee Meedecher. Si hunn 12 an 10 Joer.",
                questions: [
                    "Hutt Dir eng Famill? W√©i grouss?",
                    "Sidd Dir bestuet? Hutt dir Kanner?",
                    "W√©i dacks gesitt Dir √Ñr Elteren?",
                    "Hutt Dir Geschw√´ster?",
                    "Wat maacht Dir zesummen?",
                    "Wou wunnt de Rescht vun √§rer Famill?"
                ]
            },
            transport: {
                title: "üöå TRANSPORT - Transportation",
                sample: "All Dag fueren ech mam Bus an dann mam Tram op d'Arbecht fort. Ech fuere g√§r mam √´ffentleschen Transport well ech d'Bicher liesen kann.",
                questions: [
                    "Wat fir en Transport benotzt Dir?",
                    "Fuert Dir oft mam Bus / mam Auto?",
                    "Fuert Dir op d'Aarbecht mam Auto?",
                    "W√©i fuert Dir an d'Vakanz?",
                    "Flitt Dir oft mam Fliger?",
                    "W√©i ass de Verk√©ier zu L√´tzebuerg?"
                ]
            },
            vakanz: {
                title: "‚úàÔ∏è VAKANZ - Vacation",
                sample: "Ech reese ganz g√§r. Normalerweis, ginn ech e puer Mol d'Joer an d'Vakanz. Wann ech Vakanz hunn, fl√©ien ech mat menger Famill op d'Mier, an Spuenien.",
                questions: [
                    "Wou gitt Dir g√§r an d'Vakanz?",
                    "Mat wiem gitt Dir an d'Vakanz?",
                    "W√©i oft maacht dir Vakanz?",
                    "W√©i vill Deeg Cong√© hutt dir?",
                    "W√©ini maacht dir normalerweis Vakanz?"
                ]
            },
            iessen: {
                title: "üçΩÔ∏è IESSEN - Food",
                sample: "Et ass ganz wichteg gesond z'iessen. Ech iesse g√§r verschidden Zorte Uebst, Gem√©is, K√©is an Dessert. Ech iessen 3 Mol den Dag.",
                questions: [
                    "Wat esst Dir wann krank ass?",
                    "Wat iesst dir muer de Moien?",
                    "Wat fir L√´tzebuerger Spezialit√©iten hutt Dir prob√©iert?",
                    "Wat fir Spezialit√©ite kommen aus √Ñrem Land?"
                ]
            },
            sport: {
                title: "‚öΩ SPORT - Sports",
                sample: "Ech maachen ganz g√§r Sport. Ech wanderen g√§r, schwammen g√§r an fueren Velo och g√§r. Normalerweis, ginn ech schwammen eent Moll d'Woch.",
                questions: [
                    "Maacht Dir vill Sport? W√©i een?",
                    "W√©ini hutt Dir Z√§it dofir?",
                    "Mat wiem maacht Dir dat?",
                    "Wat ass drun interessant?",
                    "Kennt Dir l√´tzebuergesch Sportler?"
                ]
            }
        };

        // Voice recording functionality
        let mediaRecorder = null;
        let recordedChunks = [];
        let isRecording = false;
        let currentAudioUrl = null;

        async function testMicrophone() {
            const testBtn = document.getElementById('micTestBtn');
            const status = document.getElementById('recordingStatus');
            
            try {
                testBtn.textContent = '‚è≥ Testing...';
                testBtn.disabled = true;
                
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // Success - we got microphone access
                status.textContent = '‚úÖ Microphone Working!';
                status.className = 'recording-status ready';
                testBtn.textContent = '‚úÖ Microphone OK';
                testBtn.style.background = '#2ed573';
                
                // Stop the stream
                stream.getTracks().forEach(track => track.stop());
                
                setTimeout(() => {
                    testBtn.textContent = 'üîß Test Again';
                    testBtn.disabled = false;
                    testBtn.style.background = '#3498db';
                }, 2000);
                
            } catch (error) {
                console.error('Microphone test failed:', error);
                
                let errorMessage = '';
                let fixMessage = '';
                
                if (error.name === 'NotAllowedError') {
                    errorMessage = '‚ùå Microphone Blocked';
                    fixMessage = 'Click the üîí icon in your address bar and allow microphone access, then try again.';
                } else if (error.name === 'NotFoundError') {
                    errorMessage = '‚ùå No Microphone Found';
                    fixMessage = 'Please connect a microphone to your device.';
                } else if (error.name === 'NotSupportedError') {
                    errorMessage = '‚ùå Not Supported';
                    fixMessage = 'Your browser or device does not support voice recording.';
                } else {
                    errorMessage = '‚ùå Microphone Error';
                    fixMessage = 'Please check your microphone settings and try again.';
                }
                
                status.textContent = errorMessage;
                status.className = 'recording-status';
                testBtn.textContent = 'üîß Test Again';
                testBtn.disabled = false;
                testBtn.style.background = '#e74c3c';
                
                alert(`Microphone Test Failed\n\n${errorMessage}\n\n${fixMessage}\n\nTechnical error: ${error.name}`);
            }
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 44100
                    } 
                });

                recordedChunks = [];
                mediaRecorder = new MediaRecorder(stream);

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'audio/webm' });
                    currentAudioUrl = URL.createObjectURL(blob);
                    updateRecordingUI('ready');
                };

                mediaRecorder.start();
                isRecording = true;
                updateRecordingUI('recording');

            } catch (error) {
                console.error('Recording failed:', error);
                
                let errorMsg = 'Microphone access failed. ';
                if (error.name === 'NotAllowedError') {
                    errorMsg += 'Please click the üîí icon in your address bar and allow microphone access.';
                } else {
                    errorMsg += 'Please check your microphone settings.';
                }
                
                alert(errorMsg + '\n\nTip: Try the "Test Microphone" button first!');
            }
        }

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                isRecording = false;
            }
        }

        function playRecording() {
            if (currentAudioUrl) {
                const audio = new Audio(currentAudioUrl);
                audio.play().catch(error => {
                    console.error('Playback failed:', error);
                    alert('Could not play recording. Please try recording again.');
                });
            }
        }

        function toggleRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        function updateRecordingUI(status) {
            const statusElement = document.getElementById('recordingStatus');
            const recordBtn = document.getElementById('recordBtn');
            const playBtn = document.getElementById('playBtn');

            if (status === 'recording') {
                statusElement.textContent = 'üî¥ Recording...';
                statusElement.className = 'recording-status recording';
                recordBtn.textContent = '‚èπÔ∏è Stop Recording';
                recordBtn.className = 'record-btn recording';
                playBtn.disabled = true;
            } else if (status === 'ready') {
                statusElement.textContent = '‚úÖ Recording Ready';
                statusElement.className = 'recording-status ready';
                recordBtn.textContent = 'üé§ Record Again';
                recordBtn.className = 'record-btn';
                playBtn.disabled = false;
            } else {
                statusElement.textContent = '‚≠ï No Recording';
                statusElement.className = 'recording-status';
                recordBtn.textContent = 'üé§ Start Recording';
                recordBtn.className = 'record-btn';
                playBtn.disabled = true;
            }
        }

        // Load pictures
        function loadPictures() {
            const grid = document.getElementById('pictureGrid');
            grid.innerHTML = '';
            
            pictures.forEach((pic, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.onclick = () => showPictureDescription(pic);
                
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-icon">üì∏</div>
                        <div>
                            <div class="card-title">${index + 1}. ${pic.title}</div>
                            <div class="card-subtitle">${pic.subtitle}</div>
                        </div>
                    </div>
                    <p>Click to see full Luxembourgish description</p>
                `;
                
                grid.appendChild(card);
            });
        }

        function showPictureDescription(picture) {
            alert(`${picture.title}\n\nüìñ LUXEMBOURGISH DESCRIPTION:\n\n${picture.description}\n\nüí° Remember to:\n- Start with "Am Bild gesinn ech..."\n- Mention inside/outside: "D'Foto gouf banne/bausse geholl"\n- Describe foreground and background\n- Comment on weather and season`);
        }

        // Open conversation modal
        function openConversationModal(topicId) {
            const topic = conversationData[topicId];
            const modal = document.getElementById('conversationModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            modalTitle.textContent = topic.title;
            modalBody.innerHTML = `
                <h3>üìñ Sample Answer:</h3>
                <div class="sample-answer">
                    <p style="line-height: 1.6; font-size: 1.1rem;">${topic.sample}</p>
                </div>

                <h3>‚ùì Practice Questions:</h3>
                <div class="questions-list">
                    <ul>
                        ${topic.questions.map(q => `<li>${q}</li>`).join('')}
                    </ul>
                </div>

                <div class="recording-section">
                    <h4>üé§ Voice Practice</h4>
                    <p>Record yourself answering the questions above in Luxembourgish:</p>
                    
                    <div class="recording-controls">
                        <button id="micTestBtn" class="record-btn" onclick="testMicrophone()" style="background: #3498db;">
                            üîß Test Microphone
                        </button>
                        <button id="recordBtn" class="record-btn" onclick="toggleRecording()">
                            üé§ Start Recording
                        </button>
                        <button id="playBtn" class="play-btn" onclick="playRecording()" disabled>
                            ‚ñ∂Ô∏è Play Recording
                        </button>
                        <span id="recordingStatus" class="recording-status">‚≠ï No Recording</span>
                    </div>

                    <div style="margin-top: 15px; padding: 15px; background: #f0f8ff; border-radius: 8px; font-size: 0.9rem;">
                        <strong>üí° Recording Tips:</strong>
                        <ul style="margin: 8px 0 0 20px;">
                            <li>Speak clearly at normal pace</li>
                            <li>Answer completely, give examples</li>
                            <li>Use phrases like "Normalerweis...", "Ech mengen..."</li>
                            <li>Practice multiple times for better fluency</li>
                        </ul>
                    </div>
                </div>
            `;

            modal.style.display = 'block';
            
            // Reset recording state for new topic
            currentAudioUrl = null;
            isRecording = false;
            updateRecordingUI('idle');
        }

        function closeModal() {
            const modal = document.getElementById('conversationModal');
            modal.style.display = 'none';
            
            // Stop any ongoing recording
            if (isRecording) {
                stopRecording();
            }
        }

        // Tab navigation
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });

            // Remove active class from all tabs
            const tabButtons = document.querySelectorAll('.nav-tab');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });

            // Show selected tab content
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            // Add active class to clicked tab
            const activeButton = Array.from(tabButtons).find(button => 
                button.textContent.toLowerCase().includes(tabName.toLowerCase()) ||
                (tabName === 'overview' && button.textContent.includes('Overview'))
            );
            if (activeButton) {
                activeButton.classList.add('active');
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('conversationModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            showTab('overview');
            loadPictures();
        });
    </script>
</body>
</html>